<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord Modérateur - ODC Vote</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'accounts/css/modo_dashboard.css' %}">
</head>
<body>
    <div class="dashboard">
        <header>
            <h1>Bienvenue, {{ user.username }} (Modérateur)</h1>
        </header>

        
        {% if messages %}
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

       
        <div class="cards-grid">
            
            <div class="card">
                <h3>Créer un Événement</h3>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>Titre :</label>
                        <input type="text" name="title" placeholder="ex. Miss ODC" required>
                    </div>
                    <div class="form-group">
                        <label>Description :</label>
                        <textarea name="description" placeholder="Description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Date de début :</label>
                        <input type="datetime-local" name="start_date" required>
                    </div>
                    <div class="form-group">
                        <label>Date de fin :</label>
                        <input type="datetime-local" name="end_date" required>
                    </div>
                    <button type="submit" name="create_event">Créer</button>
                </form>
            </div>

         
            <div class="card">
                <h3>Créer une Épreuve</h3>
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>Événement :</label>
                        <select name="event_id" required>
                            {% for event in events %}
                                <option value="{{ event.id }}">{{ event.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Titre :</label>
                        <input type="text" name="title" placeholder="ex. Cosplay" required>
                    </div>
                    <div class="form-group">
                        <label>Description :</label>
                        <textarea name="description" placeholder="Description de l'épreuve"></textarea>
                    </div>
                    <button type="submit" name="create_trial">Créer Épreuve</button>
                </form>
            </div>

           
            <div class="card">
                <h3>Gérer les Concurrents</h3>
                
                <form method="post">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>Événement :</label>
                        <select name="event_id" required>
                            {% for event in events %}
                                <option value="{{ event.id }}">{{ event.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nom d'utilisateur :</label>
                        <input type="text" name="username" id="username" placeholder="Tapez pour suggestions..." required>
                        <div class="autocomplete-suggestions" id="suggestions"></div>
                    </div>
                    <button type="submit" name="register_competitor">Ajouter</button>
                </form>
                
                <h4>Concurrentes Existantes</h4>
                <ul>
                    {% for competitor in competitors %}
                        <li>
                            {{ competitor.user.username }} - {{ competitor.event.title }}
                            <form method="post" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="competitor_id" value="{{ competitor.id }}">
                                <button type="submit" name="delete_competitor" class="delete-btn">Supprimer</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            
            <div class="card">
                <h3>Soumissions en Attente</h3>
                <div class="form-group">
                    <label>Filtrer par Événement :</label>
                    <select id="event-filter">
                        <option value="">Tous</option>
                        {% for event in events %}
                            <option value="{{ event.id }}">{{ event.title }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Filtrer par Épreuve :</label>
                    <select id="trial-filter">
                        <option value="">Toutes</option>
                    </select>
                </div>
                <ul id="submissions-list">
                    {% for submission in submissions %}
                        <li>
                            {{ submission.competitor.user.username }} - {{ submission.trial.title }}
                            <form method="post" style="display:inline;">
                                {% csrf_token %}
                                <input type="hidden" name="submission_id" value="{{ submission.id }}">
                                <button type="submit" name="publish_submission">Publier</button>
                            </form>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

       
        <div style="text-align: center; margin-top: 20px;">
            <a href="{% url 'accounts:login' %}" class="login-button">Déconnexion</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('username');
            const suggestionsDiv = document.getElementById('suggestions');
            const members = [
                {% for member in members %}
                    "{{ member.username }}",
                {% endfor %}
            ];

            input.addEventListener('input', function() {
                const query = input.value.toLowerCase();
                suggestionsDiv.innerHTML = '';
                if (query) {
                    const filtered = members.filter(m => m.toLowerCase().includes(query));
                    if (filtered.length > 0) {
                        filtered.forEach(suggestion => {
                            const div = document.createElement('div');
                            div.className = 'autocomplete-suggestion';
                            div.textContent = suggestion;
                            div.addEventListener('click', function() {
                                input.value = suggestion;
                                suggestionsDiv.innerHTML = '';
                            });
                            suggestionsDiv.appendChild(div);
                        });
                    }
                }
            });

            // Cacher suggestions
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.innerHTML = '';
                }
            });

            const eventFilter = document.getElementById('event-filter');
            eventFilter.addEventListener('change', function() {
                
                console.log('Filtre événement :', this.value);
            });
        });
    </script>
</body>
</html>