{% extends 'base.html' %}
{% load static %}
{% block title %}Publications - {% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'contests/css/publications.css' %}">
{% endblock %}

{% block content %}
    <div class="container">
        <h2>Publications pour l'Ã‰preuve {{ trial.title }}</h2>
        <div class="publication-feed">
            {% if submissions %}
                {% for submission in submissions %}
                    <div class="publication-post">
                        <div class="post-header">
                            <span class="competitor-name">{{ submission.competitor.user.username }}</span>
                            <span class="post-date">{{ submission.published_at }}</span>
                        </div>
                        
                        {% if submission.moderator_text %}
                            <p class="moderator-text"><strong>Texte du ModÃ©rateur :</strong> {{ submission.moderator_text }}</p>
                        {% endif %}
                        
                        <p class="post-description"><strong>Texte de la Concurrente :</strong> {{ submission.description }}</p>
                        
                        {% if submission.media_files.exists %}
                            <div class="media-carousel" data-submission="{{ submission.id }}">
                                <div class="media-container">
                                    {% for media in submission.media_files.all %}
                                        <div class="media-slide {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}">
                                            {% if media.is_video %}
                                                <video controls>
                                                    <source src="{{ media.media.url }}" type="video/mp4">
                                                    Votre navigateur ne supporte pas la lecture vidÃ©o.
                                                </video>
                                            {% else %}
                                                <img src="{{ media.media.url }}" alt="Soumission {{ forloop.counter }}">
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                                
                                {% if submission.media_files.count > 1 %}
                                    <button class="carousel-btn carousel-prev">â€¹</button>
                                    <button class="carousel-btn carousel-next">â€º</button>
                                    
                                    <div class="carousel-indicators">
                                        {% for media in submission.media_files.all %}
                                            <span class="indicator {% if forloop.first %}active{% endif %}"></span>
                                        {% endfor %}
                                    </div>
                                    
                                    <div class="media-counter">
                                        <span class="current-slide">1</span> / {{ submission.media_files.count }}
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}
                        
                        <div class="post-actions">
                            <button class="action-button vote-btn {% if submission.has_voted %}voted{% endif %}" data-submission="{{ submission.id }}">
                                <span class="vote-icon">{% if submission.has_voted %}â™¥{% else %}â™¡{% endif %}</span>
                                <span class="vote-text">{% if submission.has_voted %}A votÃ©{% else %}Voter{% endif %}</span>
                                (<span class="vote-count">{{ submission.vote_count }}</span>)
                            </button>
                            <button class="action-button">ðŸ’¬ Commenter</button>
                            <button class="action-button">ðŸ“¤ Partager</button>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="no-content">Aucune publication pour le moment.</p>
            {% endif %}
        </div>
        <a href="{% url 'contests:trials' trial.event.id %}" class="button">Retour aux Ã‰preuves</a>
    </div>
    
    <div id="fullscreen-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="fullscreen-image" src="" alt="">
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'contests/js/publications.js' %}"></script>
{% endblock %}